<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ëŸ¬ì…€ ì´ë™ì¼ì§€ ì‘ì„±</title>

<style>
body { font-family: Arial, sans-serif; text-align:center; margin:20px; }
h1 { color:#336699; font-size:24px; }

form {
  display:inline-block; text-align:left;
  border:1px solid #ccc; padding:20px;
  width:100%; max-width:500px;
  background:#f9f9f9; border-radius:8px;
}

label { display:block; margin-bottom:8px; font-weight:bold; }
select, textarea {
  width:100%; padding:12px; margin-bottom:15px;
  border-radius:4px; border:1px solid #ccc;
}

button {
  padding:10px 20px; background:#336699;
  color:#fff; border:none; border-radius:4px;
  cursor:pointer;
}
button:hover { background:#28597b; }

#resetButton {
  background:#ccc; color:#000; margin-bottom:10px;
}

table {
  width:100%; max-width:700px;
  margin:20px auto; border-collapse:collapse;
}
th, td {
  border:1px solid #ccc; padding:10px;
}
thead { background:#f2f2f2; }

.score { display:none; }

/* ê³µí†µ íŒì—… */
.popup {
  display:none;
  position:fixed;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  width:80%; max-width:420px;
  background:#fff; padding:20px;
  border-radius:8px;
  box-shadow:0 0 20px rgba(0,0,0,0.2);
  z-index:1000;
}
.popup-content { text-align:center; }
.popup h2 { color:#336699; margin-bottom:10px; }
.popup-buttons { margin-top:20px; }
.popup-buttons button { margin:0 10px; }
</style>
</head>

<body>

<h1>ëŸ¬ì…€ ì´ë™ì¼ì§€&êµìœ¡ì ìˆ˜ ì‘ì„±</h1>
<button id="resetButton" onclick="resetTable()">í…Œì´ë¸” ì´ˆê¸°í™”</button>

<form id="moveForm">

<label>ê´€</label>
<select id="building" required>
  <option value="">ì„ íƒ</option>
  <option value="5-1ê´€">5-1ê´€</option>
  <option value="5-2ê´€">5-2ê´€</option>
  <option value="5-3ê´€">5-3ê´€</option>
</select>

<label>ì¢Œì„ë²ˆí˜¸</label>
<select id="seatNumber" required>
  <option value="">ì„ íƒ</option>
  <option value="A">A</option>
  <option value="B">B</option>
  <option value="C">C</option>
  <option value="D">D</option>
</select>

<select id="seatNumber2" required>
  <option value="">ì„ íƒ</option>
  <option value="01">01</option>
  <option value="02">02</option>
  <option value="03">03</option>
</select>

<label>ë³µê·€êµì‹œ</label>
<select id="returnTime" required>
  <option value="">ì„ íƒ</option>
  <option value="1">1êµì‹œ</option>
  <option value="2">2êµì‹œ</option>
  <option value="ë³µê·€ì•ˆí•¨">ë³µê·€ì•ˆí•¨</option>
</select>

<label>ì´ë™ì‚¬ìœ </label>
<select id="reason" required>
  <option value="">ì„ íƒ</option>
  <option value="ì‹¬ì•¼ììŠµ ì‹ ì²­">ì‹¬ì•¼ììŠµ ì‹ ì²­</option>
  <option value="ì‹¬ì•¼ììŠµ ì·¨ì†Œ">ì‹¬ì•¼ììŠµ ì·¨ì†Œ</option>
  <option value="ê¸°íƒ€">ê¸°íƒ€</option>
</select>

<textarea id="otherReason" style="display:none" placeholder="ê¸°íƒ€ ì‚¬ìœ "></textarea>

<button type="submit">ì œì¶œ</button>
</form>

<table id="moveList">
<thead>
<tr>
<th>ê´€</th><th>ì¢Œì„</th><th>êµì‹œ</th><th>ì‚¬ìœ </th><th>ë‚ ì§œ</th><th>ì‹œê°„</th>
</tr>
</thead>
<tbody></tbody>
</table>

<!-- ì‹¬ì•¼ììŠµ í™•ì¸ íŒì—… -->
<div id="popup" class="popup">
<div class="popup-content">
<h2>ì‹¬ì•¼ììŠµ í™•ì¸</h2>
<p id="popupText"></p>
<div class="popup-buttons">
<button onclick="confirmNight()">ì œì¶œ</button>
<button onclick="closePopup()">ì·¨ì†Œ</button>
</div>
</div>
</div>

<!-- ì¤‘ì•™ ì•ˆë‚´ íŒì—… -->
<div id="alertPopup" class="popup">
<div class="popup-content">
<h2>ì•ˆë‚´</h2>
<p id="alertPopupMessage"></p>
<div class="popup-buttons">
<button onclick="closeAlert()">í™•ì¸</button>
</div>
</div>
</div>

<script>
let moveList = [];

/* ğŸ”’ ì‹¬ì•¼ììŠµ ì°¨ë‹¨ ë‚ ì§œ */
const blockedDates = new Set([
  "2026-01-27",
  "2026-02-01"
]);

function getKST() {
  return new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Seoul"}));
}

function isNightBlocked() {
  const d = getKST();
  const day = d.getDay(); // 0=ì¼,6=í† 
  const dateStr = d.toISOString().slice(0,10);
  return day === 0 || day === 6 || blockedDates.has(dateStr);
}

function showAlert(msg){
  document.getElementById("alertPopupMessage").textContent = msg;
  document.getElementById("alertPopup").style.display="block";
}
function closeAlert(){
  document.getElementById("alertPopup").style.display="none";
}

let tempData = null;

document.getElementById("reason").addEventListener("change",e=>{
  document.getElementById("otherReason").style.display =
    e.target.value==="ê¸°íƒ€" ? "block":"none";
});

document.getElementById("moveForm").addEventListener("submit",e=>{
  e.preventDefault();

  const data = {
    building:building.value,
    seat:seatNumber.value+seatNumber2.value,
    time:returnTime.value,
    reason:reason.value==="ê¸°íƒ€"?otherReason.value:reason.value
  };

  if(data.reason.includes("ì‹¬ì•¼ììŠµ")){
    if(isNightBlocked()){
      showAlert("í† ìš”ì¼Â·ì¼ìš”ì¼ ë° ì§€ì •ëœ ë‚ ì§œì—ëŠ” ì‹¬ì•¼ììŠµ ì‹ ì²­/ì·¨ì†Œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.");
      return;
    }
    tempData = data;
    document.getElementById("popupText").textContent =
      `${data.building} / ${data.seat} / ${data.reason}`;
    document.getElementById("popup").style.display="block";
  } else {
    addRow(data);
  }
});

function confirmNight(){
  addRow(tempData);
  closePopup();
}

function closePopup(){
  document.getElementById("popup").style.display="none";
}

function addRow(d){
  const now = getKST();
  moveList.push({
    ...d,
    date: now.toISOString().slice(0,10),
    time: now.toTimeString().slice(0,8)
  });
  render();
}

function render(){
  const tb = document.querySelector("#moveList tbody");
  tb.innerHTML="";
  moveList.forEach(m=>{
    tb.innerHTML+=`
      <tr>
        <td>${m.building}</td>
        <td>${m.seat}</td>
        <td>${m.time}</td>
        <td>${m.reason}</td>
        <td>${m.date}</td>
        <td>${m.time}</td>
      </tr>`;
  });
}

function resetTable(){
  moveList=[];
  render();
}
</script>

</body>
</html>
